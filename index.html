<!DOCTYPE HTML>
<html>

  <head>
    <script src="js/jquery-1.11.0.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap.file-input.js"></script>
    
    <script>
    var numStars = 3;
    var docStart = true;
    var questType = "Words";
    var questNum = 0;

    function redirect(string){
      window.location = string;
      if ($(string).css("display") == "none")
        $(string).show();
    }

    function clickItem(string){
      $(string).click();
    }

    $(function(){
      $("#settingsModal input").keydown(function(event) {
        if (event.which == 13) {
            event.preventDefault();
            changeSettings(this.form)
        }
      });
    })

    $(function(){
      $("#inventoryButton").click(function(){
        var divClass = $("#leftArrow").css("display");
	      if(divClass == "none"){
          $("#mainBody").animate({left:'0%'}, function(){
            $('#leftArrow').show();
            $("#rightArrow").css('display', "none");
          });
          $("#settingsDiv").css('display', "none");
          document.getElementById("inventoryText").innerHTML = 'Close Inventory';
        }
        else{
          $("#mainBody").animate({left:'-80%'}, function(){
            $("#settingsDiv").show();
            $("#leftArrow").css('display', "none");  
            $("#rightArrow").show();
          });       
          document.getElementById("inventoryText").innerHTML = 'Open Inventory';
        }
      });
     });

    $(function(){
      $('#textEditorTextArea').keyup(function(){
        var wordCount = 0;
        var paragraphCount = 0;
        var startsAndFinishes = $('#'+this.id).val().match(/\b/g);
        var newlinesWithText = $('#'+this.id).val().match(/(\n.)|(^.)/g);
        if (startsAndFinishes) {
          wordCount = startsAndFinishes.length / 2;
        }
        if (newlinesWithText) {
            paragraphCount = newlinesWithText.length;
          }

        var statement = "<strong>Goal: </strong>" + questNum + " " + questType + "<br /> <strong>Progress: </strong>";
        var countType;
        if (questType == "Words")
        {
          countType = wordCount;
        }
        else if (questType == "Paragraphs")
        {
          countType = paragraphCount;
        }
        else if (questType == "Pages")
        {
          countType = 0;
        }

        statement = statement + countType + " " + questType;
        if (countType == 1)
          statement = statement.substring(0, statement.length - 1);
        $('#counts').html(statement);
      });
    });

    function changeSettings(form){
      console.log("Document Title: " + form.docName.value);
      console.log("Document Author: " + form.docAuthor.value);
      console.log("Paper Length Goal: " + form.lengthNum.value + " " + form.lengthType.value);

      if (form.docName.value != "")
      {
        document.getElementById("documentTitle").innerHTML = form.docName.value;
      }
      else
      {
        document.getElementById("documentTitle").innerHTML = "Untitled";
      }

      if (form.docAuthor.value != "")
      {
        $("#documentBy").show();
        document.getElementById("documentAuthor").innerHTML = form.docAuthor.value;
      }

      if (form.lengthNum.value != "")
      {
        questType = form.lengthType.value;
        questNum = form.lengthNum.value;
      }

      $("#textEditorTextArea").css("top", $('#documentSection').css("height"));

      if (docStart)
      {
        docStart = false;
      }

      redirect('#close');
      return false;
    }

    function cancel(){
      if (!docStart)
      {
        redirect('#menuModal');
      }
      else
      {
        redirect('#startModal');
      }
    }

    function showAbout(){
      window.location = "#aboutModal";
      return false;
    }

    function newDoc(){
      document.getElementById("settingsTitle").innerHTML = "New Document";
      $('#initButton').attr("type", "button");
      $('#cancelButton').attr("type", "button");
      $('#changeButton').attr("type", "hidden");
      $("#docName").val("");
      $("#docAuthor").val("");
      $("#lengthNum").val("");
      $("#lengthType").val("Words");
      document.getElementById("textEditorTextArea").value="";
      redirect('#settingsModal');
    }

    function oldDoc(){
      document.getElementById("settingsTitle").innerHTML = "Edit Document Settings";
      $('#initButton').attr("type", "hidden");
      $('#changeButton').attr("type", "button");
      $('#cancelButton').attr("type", "button");
      $("#docName").val(document.getElementById("documentTitle").innerHTML);
      $("#docAuthor").val(document.getElementById("documentAuthor").innerHTML);
      $("#lengthNum").val(questNum);
      $("#lengthType").val(questType);
      redirect('#settingsModal');
    }

    $(document).ready(function(){
      redirect('#startModal');
      window.title = "Hat Scribe";
    });

    function gamble(){
      numStars = numStars - 1;
      var tempArray = document.getElementsByName('numStars');
      for(var i = 0; i < tempArray.length;i++)
      {
        tempArray[i].innerHTML = numStars;
      }
      alert('You just gambled!');

      if (numStars <= 0)
      {
        $("#gambleButton").attr("disabled", true);
        $("#breakButton").attr("disabled", true);
      }
    }

    function handleFileSelect(evt){
      var files = evt.target.files;
      var file = files[0];
      
      var reader = new FileReader();
      reader.onload = readFile;
      reader.readAsText(file);

      function readFile(){
       var words = reader.result;
       document.getElementById("textEditorTextArea").value = words;
       redirect("#close");
      }
    }

    $(function(){
      document.getElementById('loadFile').addEventListener('change',handleFileSelect,false);
      document.getElementById('loadButton').addEventListener('change',handleFileSelect,false);

      $('input[type=file]').bootstrapFileInput();
      $('.file-inputs').bootstrapFileInput();
    });


    var currentPage = 1;
    function changePage(input)
    {
      $('#page' + currentPage).removeClass("active");
      if (input == "+1")
      {
        currentPage = parseInt(currentPage) + parseInt(1);
      }
      else if (input == "-1")
      {
        currentPage = parseInt(currentPage) - parseInt(1);
      }
      else
      {
        currentPage = input;
      }

      $('#page' + currentPage).addClass("active");
      console.log("Trying to toggle page " + currentPage);
      if (currentPage == 1)
      {
        $('#pageLeft').addClass("disabled");
        $('#pageRight').removeClass("disabled");
      }
      else if (currentPage == 5)
      {
        $('#pageRight').addClass("disabled");
        $('#pageLeft').removeClass("disabled");
      }
      else
      {
        $('#pageLeft').removeClass("disabled");
        $('#pageRight').removeClass("disabled");
      }
    }

    var numNotifications = 0;
    function newNotification(){
      var val = Math.floor(Math.random()*3);
      if(val == 0){
        addNotification("XP", Math.floor(Math.random()*1000));
      }
      else if(val == 1){
        addNotification("Star", 0);
      }
      else{
        addNotification("Hat", 0);
      }
    }

    function addNotification(type, value){
      var image, message;
      if(type=="XP"){
        image="XP.png";
        message="You got " + value + " experience, dood!";
      }
      else if(type=="Star"){
        image="StarReward.png";
        message="You got a star, dood!";
      }
      else{
        image="Hat.png";
        message="You got a hat, dood!";
      }
      var div= document.createElement('div');
      div.className = 'notificationBox';
      var img = document.createElement('image');
      img.className = 'notificationImage';
      img.src = image;
      var text = document.createElement('div');
      text.className = 'notificationText';
      text.innerHTML = message;

      div.appendChild(img);
      div.appendChild(text);

      var noteBox = document.getElementById("notificationBoxes");
      if(numNotifications == 5){
        noteBox.removeChild(noteBox.childNodes[4]);
        numNotifications = 4;
      }
      noteBox.insertBefore(div,noteBox.firstChild);
      numNotifications++;
      
    }
    
    </script>

    <link rel ="stylesheet" type="text/css" href="css/stylesheet.css">
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    
  </head>
  <body>
    <div id="startModal" class="modalDialog">
      <div>
        <form name="setup" id="setup" align="center">
          <div class="page-header">
            <h1> Welcome to Hat Scribe </h1>
          </div>
          <input type="button" class="btn btn-block btn-default" value="Create New Document" onClick="redirect('#settingsModal')"></input>
          <br>
          <input type="button" class="btn btn-block btn-default" value="Load Document" onClick="clickItem('#loadFile')"></input>
          <div style="display:none">
            <input type="file" id="loadFile" accept=".txt"></input>
          </div>
          <br>
          <input type="button" class="btn btn-block btn-default" value="About Hat Scribe" onClick="redirect('#aboutModal')"></input>
        </form>
        <br>
      </div>
    </div>

    <div id="aboutModal" class="modalDialog" style="display:none">
      <div>
        <div class="page-header">
          <h2> About Hat Scribe </h2>
        </div>
        <p> Hat Scribe is an interactive drafting tool intended to motivate users to write more by gamifying the writing process. This tool was designed by Team Mad Milliners for EECS 493, the User Interface class at the University of Michigan. <br><br>
          Our team consists of Vicki Li, Daniel Nees, and John Rabideau (with some initial help from Emily Stearns). All of us are computer science majors at the Engineering School here in Ann Arbor and qualified nerds/geeks.<br><br>
          If you have any questions, comments, or suggestions, we would love to hear them! Email your feedback to vickili@umich.edu, or let one of us know through any (preferably non-magical) methods otherwise.
        </p>
        <br>
        <input type="button" class="btn btn-block btn-default" value="Return" onClick="redirect('#startModal')"></input>
      </div>
    </div>

    <div id="menuModal" class="modalDialog" style="display:none">
      <div align="center">
          <div class="page-header">
            <h2> Menu </h2>
          </div>
          <input type="button" class="btn btn-block btn-default" id="createButton" value="Edit Document Settings" onClick="oldDoc()"></input><br>
          <input type="button" class="btn btn-block btn-default" id="createButton" value="Create New Document" onClick="newDoc()"></input><br>
          <input type="button" class="btn btn-block btn-default" id="saveButton" value="Save Document" onClick=""></input><br>
          <input type="button" class="btn btn-block btn-default" value="Load Document" onClick="clickItem('#loadButton')"></input>
          <div style="display:none">
            <input type="file" id="loadButton" accept=".txt"></input>
          </div>
          <br>
          <input type="button" class="btn btn-block btn-default" id="returnButton" value="Return" onClick="redirect('#close')"></input><br>
      </div>
    </div>

    <div id="settingsModal" class="modalDialog" style="display:none">
      <div>
        <form name="settings" id="settings">
          <div class="page-header">
            <h2 id="settingsTitle"> New Document </h2>
          </div>
          <div class="input-group">
            <span class="input-group-addon">Title: </span> 
            <input type="text" class="form-control" id="docName" placeholder="Untitled" autofocus>
          </div>
          <div class="input-group">
            <span class="input-group-addon">Author: </span> 
            <input type="text" class="form-control" id="docAuthor" placeholder="Batman">
          </div>
          <div class="input-group">
            <span class="input-group-addon">Paper Length Goal: </span>
            <input type="text" class="form-control" id="lengthNum" maxlength="5" size="5">
              <select id="lengthType" class="form-control">
                <option value="Words">Words</option>
                <option value="Paragraphs">Paragraphs</option>
                <option value="Pages">Pages</option>
              </select>
            </select>
          </div>
          <br>
          <input id="initButton" class="btn btn-block btn-primary" type="button" value="Create Document" onClick="changeSettings(this.form)"></input>
          <input id="changeButton" class="btn btn-block btn-primary" type="hidden" value="Save Changes" onClick="changeSettings(this.form)"></input>
          <input id="cancelButton" class="btn btn-block btn-default" type="button" value="Cancel" onClick="cancel()"></input>
        </form>
        <br>
      </div>
    </div>

    <div id="breakModal" class="modalDialog" style="display:none">
      <div>
        <div class="text-center">
          <img id="star" src="star.png">
          x <span name="numStars">3</span>
        </div>
        <div class="well" id="gameBlock">
        </div>
        <br>
        <input id="gambleButton" class="btn btn-block btn-primary" type="button" value="Use a Star" onClick="gamble()"></input>
        <input id="closeButton" class="btn btn-block btn-default" type="button" value="Back to Work" onClick="redirect('#close')"></input>
      </div>
    </div>

    <div class="mainBody" id="mainBody">
      <div class="inventory bg-primary" id="inventory">
        <div class="offInventory" id="offInventory">
          <div id="inventoryBox">
            <div class="inventoryRow">
             <div class="inventoryBox">Item 1</div>
             <div class="inventoryBox">Item 2</div>
             <div class="inventoryBox">Item 3</div>
             <div class="inventoryBox">Item 4</div>
             <div class="inventoryBox">Item 5</div>
            </div>
            <div class="inventoryRow">
             <div class="inventoryBox">Item 6</div>
             <div class="inventoryBox">Item 7</div>
             <div class="inventoryBox">Item 8</div>
             <div class="inventoryBox">Item 9</div>
             <div class="inventoryBox">Item 10</div>
            </div>
          </div>
          <div class="text-center">
            <ul id="pagesDiv" class="pagination">
              <li id="pageLeft" class="disabled"><a onClick="changePage('-1')">&laquo;</a></li>
              <li id="page1" class="active"><a onClick="changePage('1')">1<span class="sr-only">(current)</span></a></li>
              <li id="page2"><a onClick="changePage('2')">2</a></li>
              <li id="page3"><a onClick="changePage('3')">3</a></li> 
              <li id="page4"><a onClick="changePage('4')">4</a></li> 
              <li id="page5"><a onClick="changePage('5')">5</a></li>                              
              <li id="pageRight"><a onClick="changePage('+1')">&raquo;</a></li>
            </ul>
          </div>
        </div>
        <button class="btn btn-block" id="inventoryButton" type="button">
          <span class="glyphicon glyphicon-arrow-right" id="rightArrow"></span>
          <span class="glyphicon glyphicon-arrow-left" id="leftArrow" style="display:none"></span>
          <strong id="inventoryText">Open Inventory</strong>
        </button>
        <div id="AvatarStats">
          <span class="lead">Mark Stackerman</span>
          <small>Level 17</small>
          <br><br>
          <div class="progress">
            <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="" aria-valuemin="0" aria-valuemax="500" style="width:58.67%; height:20px">
            342/500 XP
            </div>
          </div>
        </div>
      </div>
      <div class="rightHalf" id="rightHalf">
        <div class="middleSection" id="middleSection">
          <div class="textEditor" id="textEditor">
            <div class="jumbotron text-center" id="documentSection">
              <h3 id="documentTitle"></h3>
              <small id="documentBy" style="display:none">by </small>
              <small id="documentAuthor"></small>
            </div>
            <textarea id="textEditorTextArea" class="form-control" placeholder="Start typing here!"></textarea>
          </div>
          <div class="break" id="break">
            <div id="counts"></div>
            <button id="breakButton" class="btn btn-danger" onClick="redirect('#breakModal')">
              <span class="glyphicon glyphicon-star"></span>
              Take a Break!
              <span class="glyphicon glyphicon-star"></span>
            </button>
            <div id="stardiv" align="right">
              <img id="star" src="star.png">
              <span> x <span name="numStars">3</span> </span>
            </div>
          </div>
        </div>
        <div class="notifications bg-info" id="notifications">
          <div id="settingsDiv" class="page-header">
            <button class="btn btn-block" id="settingsOpen" onClick="redirect('#menuModal')">
                <span class="glyphicon glyphicon-cog"></span>
                Settings
            </button>
          </div>
          <div id="notificationBoxes">
          <button class="btn" onClick="newNotification();">New Note!</button>
          </div>
        </div>
      </div>

    </div>

  </body>

</html>